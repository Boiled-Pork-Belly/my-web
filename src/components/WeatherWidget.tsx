// =====================================================================
// 📁 파일명: WeatherWidget.tsx
// 📍 위치: src/components/WeatherWidget.tsx
// 🎯 역할: 날씨 정보와 AI 추천을 보여주는 UI 컴포넌트
// 📝 설명: 이 파일은 "컴포넌트(Component)"입니다.
//         컴포넌트는 화면의 일부분을 담당하는 재사용 가능한 UI 조각이에요.
//         이 위젯을 어떤 페이지에든 <WeatherWidget /> 형태로 붙일 수 있습니다.
// =====================================================================

// ---------------------------------------------------------------------
// 1. 필요한 도구들 불러오기 (import)
// ---------------------------------------------------------------------

// useWeather: 우리가 만든 커스텀 훅 (날씨 데이터 + AI 추천 로직)
// '../hooks/useWeather': 상대 경로로 파일 위치 지정
//   .. = 상위 폴더로 이동
//   /hooks = hooks 폴더로 들어감
//   /useWeather = useWeather.ts 파일 (확장자 생략 가능)
import useWeather from '../hooks/useWeather';

// CSS 파일 불러오기 (이 컴포넌트 전용 스타일)
import './WeatherWidget.css';

// ---------------------------------------------------------------------
// 2. 컴포넌트 함수 정의
// ---------------------------------------------------------------------

// export default: 다른 파일에서 import할 수 있게 내보냄
// function WeatherWidget(): 컴포넌트 이름 (대문자로 시작하는 게 규칙!)
export default function WeatherWidget() {

    // ===================================================================
    // 3. 훅에서 필요한 값들 가져오기 (구조 분해 할당)
    // ===================================================================

    // useWeather(): 훅 함수 호출 → 객체 반환
    // { ... } = : 구조 분해 할당 (객체에서 필요한 것만 꺼내기)
    // 
    // 꺼내오는 값들:
    //   - currentTemp: 현재 기온 (숫자 또는 null)
    //   - hourlyTemps: 시간별 기온 배열
    //   - aiRecommendation: AI 추천 멘트
    //   - loading: 로딩 중 여부 (true/false)
    //   - error: 에러 메시지
    //   - fetchWeather: 날씨 가져오기 함수
    const { currentTemp, hourlyTemps, aiRecommendation, loading, error, fetchWeather } = useWeather();

    // ===================================================================
    // 4. JSX 반환 (화면에 그릴 내용)
    // ===================================================================

    // return ( ... ): 컴포넌트가 화면에 그릴 HTML 구조
    // JSX: JavaScript 안에서 HTML처럼 쓸 수 있는 문법
    return (
        // ---------------------------------------------------------------------
        // 최상위 컨테이너
        // ---------------------------------------------------------------------
        // className: HTML의 class와 같음 (JavaScript에서 class는 예약어라서)
        // "weather-widget": CSS 파일에서 .weather-widget { ... }으로 스타일 적용
        <div className="weather-widget">

            {/* 
        ---------------------------------------------------------------------
        타이틀 영역
        ---------------------------------------------------------------------
        JSX에서 주석은 이렇게 씀: {/* 내용 *\/}
      */}
            <h3 className="weather-title">🌤️ 서울 날씨 & AI 코디</h3>

            {/* 
        ---------------------------------------------------------------------
        로딩 상태 표시 (조건부 렌더링)
        ---------------------------------------------------------------------
        {loading && <p>...</p>}
        
        이게 무슨 뜻이냐면:
        - loading이 true면 → && 뒤의 <p> 태그를 보여줌
        - loading이 false면 → 아무것도 안 보여줌
        
        왜 이렇게 되냐면:
        - JavaScript에서 false && "뭐든" = false (첫 번째에서 끝남)
        - JavaScript에서 true && "뭐든" = "뭐든" (두 번째 값 반환)
        - React는 false를 받으면 아무것도 안 그림
      */}
            {loading && <p className="weather-loading">데이터 배달 중... 🚚</p>}

            {/* 
        ---------------------------------------------------------------------
        에러 상태 표시
        ---------------------------------------------------------------------
        error가 null이 아니면 (= 에러가 있으면) 에러 메시지 표시
      */}
            {error && <p className="weather-error">{error}</p>}

            {/* 
        ---------------------------------------------------------------------
        날씨 데이터 영역 (조건부 렌더링)
        ---------------------------------------------------------------------
        currentTemp !== null: currentTemp가 null이 아닐 때만 보여줌
        왜? 처음에는 데이터가 없으니까 (null 상태)
        
        !== : 엄격한 불일치 비교 (타입까지 비교)
        != : 느슨한 불일치 비교 (타입 변환 후 비교) - 권장하지 않음
      */}
            {currentTemp !== null && (
                <div className="weather-data">

                    {/* 현재 기온 (메인 - 큰 글씨) */}
                    {/* {currentTemp}: JavaScript 변수를 JSX에 넣을 때는 중괄호로 감싸기 */}
                    {/* °C: 섭씨 기호 */}
                    <h2 className="weather-temp">{currentTemp}°C</h2>

                    {/* 
            시간대별 기온 카드
            hourlyTemps[0]: 배열의 첫 번째 요소 (자정 0시)
            hourlyTemps[12]: 배열의 13번째 요소 (점심 12시)
            hourlyTemps[18]: 배열의 19번째 요소 (저녁 18시)
            
            <strong>: 굵은 글씨 태그
          */}
                    <div className="weather-hourly">
                        <p>🕛 자정: <strong>{hourlyTemps[0]}°C</strong></p>
                        <p>☀️ 점심(12시): <strong>{hourlyTemps[12]}°C</strong></p>
                        <p>🌙 저녁(18시): <strong>{hourlyTemps[18]}°C</strong></p>
                    </div>

                    {/* 
            ---------------------------------------------------------------------
            AI 추천 영역 (말풍선 스타일)
            ---------------------------------------------------------------------
          */}
                    <div className="ai-recommendation">
                        {/* AI 타이틀 */}
                        <p className="ai-title">🤖 AI 스타일리스트의 조언:</p>

                        {/* 
              삼항 연산자로 조건부 렌더링
              
              문법: 조건 ? 참일때 : 거짓일때
              
              aiRecommendation ? (AI답변 표시) : (로딩메시지 표시)
              - aiRecommendation이 있으면 → AI 답변 보여줌
              - aiRecommendation이 null이면 → "고민 중" 메시지 보여줌
            */}
                        {aiRecommendation ? (
                            // AI 답변이 도착했을 때
                            <p className="ai-text">{aiRecommendation}</p>
                        ) : (
                            // AI 답변을 기다리는 중일 때
                            <p className="ai-loading">열심히 고민 중이에요... 🤔</p>
                        )}
                    </div>
                </div>
            )}

            {/* 
        ---------------------------------------------------------------------
        버튼 영역
        ---------------------------------------------------------------------
        onClick={fetchWeather}: 클릭하면 fetchWeather 함수 실행
        
        ⚠️ 주의: onClick={fetchWeather()} 이렇게 하면 안 됨!
        왜? ()를 붙이면 렌더링할 때 바로 실행돼버림
        
        버튼 텍스트도 조건부로 변경:
        - 데이터가 있으면 → "새로고침"
        - 데이터가 없으면 → "날씨 불러오기"
      */}
            <button onClick={fetchWeather} className="weather-btn">
                {currentTemp ? '🔄 새로고침' : '☁️ 날씨 불러오기'}
            </button>
        </div>
    );
}
